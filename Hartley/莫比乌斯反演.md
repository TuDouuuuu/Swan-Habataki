[TOC]

# 莫比乌斯反演

## 1.数论函数

### 		1)莫比乌斯函数

​				$\mu(n)=\begin{cases}{1}，n=1\\ {-1}^{k}，n=\prod_{i=1}^{k}{p_i}\\ 0，n=else\end{cases}$

##### 				性质

​				$\mu(1)=1$

​				$\mu(p)=-1$

​				$i\%x=0\quad\mu(i\cdot x)=0$

​				$i\%x≠0\quad \mu(i\cdot x)=-\mu(i)$



​				<u>**重要！用于条件转化：**</u>
$$
\sum_{d|n}\mu(d)=[n=1]
$$


### 	2)欧拉函数

##### 				定义

​			$\quad\varphi(n)$为1-n内与n互质的数的个数​	

​				$\varphi(n)=n\prod_{i=1}^{k}(1-\frac{1}{p_i})\quad n=p_1^{\alpha_1}p_2^{\alpha_2}\cdots p_k^{\alpha_k}$

##### 				性质

​				$\varphi(1)=1$

​				$\varphi(p)=p-1$

​				$i\%x=0\quad\varphi(i\cdot x)=\varphi(i)\cdot x$

​				$i\%x≠0\quad \varphi(i\cdot x)=\varphi(i)\cdot\varphi(x)$



​				<u>**重要！以下性质常用：**</u>

​				n的因子的欧拉函数值之和为n:

​								$\sum_{d|n}\varphi(d)=n\quad(\varphi*I=id)$

​				小于n且与n互质的数的和：

​								$S(n)=\begin{cases} \frac{n\cdot\varphi(n)}{2}，n≧2\\0，n=1\end{cases}$

​				若a，m互质，则

​								$a^{\varphi(m)}≡1\quad(mod\quad m)$		

​		

### 	3)最小素因子出现的次数

##### 				性质

​				$F(1)=1$

​				$F(p)=1$

​				$i\%x=0\quad F(i \cdot x)=F(i)+1$

​				$i\%x≠0\quad F(i\cdot x)= 1$



### 	4)约数个数函数		[lightoj - 1028](http://www.lightoj.com/volume_showproblem.php?problem=1028)

##### 				性质

​				$d(1)=1$

​				$d(p)=2$

​				$i\%x=0\quad d(i \cdot x)=d(i)\cdot\frac{F(i)+2}{F(i)+1}$

​				$i\%x≠0\quad d(i\cdot x)=d(i)\cdot d(x)$



### 	5)最小素因子的0-k次幂之和

​				即$(1+p_1+p_1^2+\cdots+p_1^{k_1})\quad\quad x=p_1^{k1}p_2^{k_2}\cdots p_n^{k_n}$

##### 				性质

​				$pk(1)=0$

​				$pk(p)=p+1$

​				$i\%x=0\quad pk(i \cdot x)=pk(i)\cdot x+1$

​				$i\%x≠0\quad pk(i\cdot x)=x+1$



### 	6)约数和函数

##### 				性质

​				$\sigma(1)=1$

​				$\sigma(p)=p+1$

​				$i\%x=0\quad\sigma(i \cdot x)=\sigma(i)\cdot\frac{pk(i\cdot x)}{pk(i)}$

​				$i\%x≠0\quad\sigma(i\cdot x)=\sigma(i)\cdot\sigma(x)$

​				

### 	7)基础数论函数

$$
I(n)=1
\\id(n)=n
\\e(n)=\begin{cases} 1,n=1 \\0,n\neq0\end{cases}
$$



### 8)数论函数线性筛模板(6个常用函数)

```c++
const int MAXN=1e6+5;  
int prime[MAXN],pnum=0;
bool vis[MAXN];//是否是素数 
int mu[MAXN];//莫比乌斯函数
int phi[MAXN];//欧拉函数
int F[MAXN];//最小素因子出现的次数
int d[MAXN];//约数个数
int pk[MAXN];//最小素因子的0-k次幂之和
int sigma[MAXN];//约数和 
void sieve(){
	memset(vis,true,sizeof(vis)); 
	vis[0]=vis[1]=false;//x=1的特例  
	mu[1]=1; 
	phi[1]=1;
	F[1]=1;
	d[1]=1;
	pk[1]=0;
	sigma[1]=1;
	for(int i=2;i<MAXN;i++){
		if(vis[i]){
			prime[pnum++]=i;
			mu[i]=-1;
			phi[i]=i-1;
			F[i]=1;
			d[i]=2;
			pk[i]=i+1;
			sigma[i]=i+1;
		} 
		for(int j=0;j<pnum&&1LL*i*prime[j]<MAXN;j++){
			int x=prime[j];
			vis[i*x]=false;
			if(i%x==0){//x是i的最小素因子 
				mu[i*x]=0;
				phi[i*x]=phi[i]*x;
                F[i*x]=F[i]+1;
                d[i*x]=d[i]/(F[i]+1)*(F[i]+2); 
                pk[i*x]=pk[i]*x+1;
                sigma[i*x]=sigma[i]/pk[i]*pk[i*x];
				break;
			} 
			else{//i,x互质
				mu[i*x]=-mu[i];
				phi[i*x]=phi[i]*phi[x];
                F[i*x]=1;
				d[i*x]=d[i]*d[x];
				pk[i*x]=1+x;
				sigma[i*x]=sigma[i]*sigma[x];
			}
		}
	}
}
```



## 2.迪利克雷卷积

#### 性质

1)	结合律 , $f*(g*h)=(f*g)*h$

2)	交换律 , $f*g=g*f$

3)	当$\quad h=f*g\quad$时

​		可得$\quad h(n)=\sum_{d|n}f(d)*g(\frac{n}{d})\quad$或$\quad h(n)=\sum_{n|d}f(d)*g(\frac{d}{n})$

4)	基本公式
$$
\\
\\\  
\\\varphi*I=id
\\\mu*I=e
\\\mu*id=\varphi
\\\
$$



## 3.杜教筛

​		用于求积性函数 f(i) 的前缀和
$$
S(n)=\sum_{i=1}^nf(i)\quad
$$
​		构造h和g使得$h=f*g$

​			$\sum_{i=1}^{n}h(i)$

​		$=\sum_{i=1}^n\sum_{d|i}g(d)\cdot f(\frac{i}{d})$

​		$=\sum_{d=1}^ng(d)\sum_{i=1}^{⌊\frac{n}{d}⌋}f(i)$					

​		$=\sum_{d=1}^ng(d)\cdot S(⌊\frac{n}{d}⌋)$				

​		$=g(1)\cdot S(n)+\sum_{d=2}^ng(d)\cdot S(⌊\frac{n}{d}⌋)$



​		因此可得
$$
g(1)\cdot S(n)=\sum_{i=1}^nh(i)-\sum_{d=2}^ng(d)\cdot S(⌊\frac{n}{d}⌋)
$$
​		一般线性筛至$\sqrt n$ 左右，再用杜教筛。



### 1)模板题	

​	①求$S(n)=\sum_{i=1}^n\mu(i)$		[luogu - 4213](https://www.luogu.org/problem/P4213)

​		取$g=I，h=\mu*I=e$

​		$∴I(1)\cdot S(n)=\sum_{i=1}^ne(i)-\sum_{d=2}^nI(d)\cdot S(⌊\frac nd⌋)$

​			$S(n)=1-\sum_{d=2}^nS(⌊\frac nd⌋)$



​	②求$S(n)=\sum_{i=1}^n\varphi(i)$		[luogu - 4213](https://www.luogu.org/problem/P4213)

​		取$g=I，h=\varphi*I=id$

​		$∴I(1)\cdot S(n)=\sum_{i=1}^nid(i)-\sum_{d=2}^nI(d)\cdot S(⌊\frac nd⌋)$

​			$S(n)=\frac{n(n+1)}2-\sum_{d=2}^nS(⌊\frac nd⌋)$



​	③求$S(n)=\sum_{i=1}^ni\cdot\varphi(i)$

​		取$g=id，h(n)=\sum_{d|n}d\cdot\varphi(d)\cdot\frac nd=n\sum_{d|n}\varphi(d)=n^2$

​		$∴id(1)\cdot S(n)=\sum_{i=1}^ni^2-\sum_{d=2}^nid(d)\cdot S(⌊\frac nd⌋)$

​			$S(n)=\frac{n(n+1)(2n+1)}6-\sum_{d=2}^nd\cdot S(⌊\frac nd⌋)$



### 2)杜教筛模板(①+②)

```c++
typedef long long ll;
const int MAXN=5000010;//线性筛到最大的2/3次方 
int prime[MAXN],pnum=0;
bool vis[MAXN];
int phi[MAXN],mu[MAXN];//欧拉函数和莫比乌斯函数 
ll sum1[MAXN],sum2[MAXN];//存MAXN以下的前缀和 
void sieve(){//线性筛 
	memset(vis,true,sizeof(vis));
	vis[0]=vis[1]=false;
	mu[1]=1;
	phi[1]=1;
	for(int i=2;i<MAXN;i++){
		if(vis[i]){
			prime[pnum++]=i;
			mu[i]=-1;
			phi[i]=i-1;
		}
		for(int j=0;j<pnum&&1ll*i*prime[j]<MAXN;j++){
			int x=prime[j];
			vis[i*x]=false;
			if(i%x==0){
				mu[i*x]=0;
				phi[i*x]=phi[i]*x;
				break;
			}
			else{
				mu[i*x]=-mu[i];
				phi[i*x]=(x-1)*phi[i];
			}
		} 
	}
	for(int i=1;i<=MAXN;i++){//求一部分前缀和 
		sum1[i]=sum1[i-1]+phi[i];
		sum2[i]=sum2[i-1]+mu[i];
	}
}
unordered_map<int,ll>sumphi;//数组下标放不下 
ll djsphi(int x){
	if(x<=MAXN)
		return sum1[x];
	if(sumphi[x])
		return sumphi[x];
	ll ans=1ll*(x+1)*x/2;
	for(int l=2,r;l<=x;l=r+1){
		r=x/(x/l);
		ans-=1ll*(r-l+1)*djsphi(x/l);
	}
	return sumphi[x]=ans;//记忆化保存前缀和 
}
unordered_map<int,int>summu;
ll djsmu(int x){
	if(x<=MAXN)
		return sum2[x];
	if(summu[x])
		return summu[x];
	ll ans=1;
	for(int l=2,r;l<=x;l=r+1){
		r=x/(x/l);
		ans-=1ll*(r-l+1)*djsmu(x/l);
	}
	return summu[x]=ans;
}
```



## 4.例题

### 1.$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=1]$

​		$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=1]$

​	$=\sum_{i=1}^{n}\sum_{j=1}^{m}\sum_{d|gcd(i,j)}\mu(d)$

​	$=\sum_{d=1}^{min(n,m)}\mu(d)\sum_{i=1}^{⌊\frac{n}{d}⌋}\sum_{j=1}^{⌊\frac{m}{d}⌋}$

​	$=\sum_{d=1}^{min(n,m)}\mu(d)\cdot⌊\frac{n}{d}⌋\cdot⌊\frac{m}{d}⌋$



### 2.$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=k]$		[hdu - 1695](http://acm.hdu.edu.cn/showproblem.php?pid=1695)

​		$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)==k]$

​	$=\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(\frac{i}{k},\frac{j}{k})=1]$

​	$=\sum_{i=1}^{⌊\frac{n}{k}⌋}\sum_{j=1}^{⌊\frac{m}{k}⌋}[gcd(i,j)=1]$

​	$=\sum_{i=1}^{⌊\frac{n}{k}⌋}\sum_{j=1}^{⌊\frac{m}{k}⌋}\sum_{d|gcd(i,j)}\mu(d)$

​	$=\sum_{d=1}^{min(⌊\frac{n}{k}⌋,⌊\frac{m}{k}⌋)}\mu(d)\sum_{i=1}^{⌊\frac{n}{kd}⌋}\sum_{j=1}^{⌊\frac{m}{kd}⌋}$

​	$=\sum_{d=1}^{min(⌊\frac{n}{k}⌋,⌊\frac{m}{k}⌋)}\mu(d)\cdot⌊\frac{n}{kd}⌋\cdot⌊\frac{m}{kd}⌋$



### 3.$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=prime]$		[luogu - 2257](https://www.luogu.org/problem/P2257)

​		$\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=prime]$

​	$=\sum_{i=1}^{n}\sum_{j=1}^{m}\sum_{p=2}^{min(n,m)}[gcd(i,j)=p]$

​	$=\sum_{p=2}^{min(n,m)}\sum_{i=1}^{⌊\frac{n}{p}⌋}\sum_{j=1}^{⌊\frac{m}{p}⌋}[gcd(i,j)=1]$

​	$=\sum_{p=2}^{min(n,m)}\sum_{i=1}^{⌊\frac{n}{p}⌋}\sum_{j=1}^{⌊\frac{m}{p}⌋}\sum_{d|gcd(i,j)}\mu(d)$

​	$=\sum_{p=2}^{min(n,m)}\sum_{d=1}^{min(⌊\frac{n}{p}⌋,⌊\frac{m}{p}⌋)}\mu(d)\cdot⌊\frac{n}{dp}⌋\cdot⌊\frac{n}{dp}⌋$

​	令 x = dp

​	$=\sum_{x=2}^{min(n,m)}⌊\frac{n}{x}⌋\cdot⌊\frac{m}{x}⌋\sum_{p|x}\mu(⌊\frac{x}{p}⌋)$

​	令 $f(x)=\sum_{p|x}\mu(⌊\frac{x}{p}⌋)$，线性筛$f(x) $

​		$f(1)=0$

​		$f(p)=1$

​		$i\%x=0\quad f(i\cdot x)=\mu(x)$

​		$i\%x≠0\quad f(i\cdot x)=\mu(x)-f(x)$

​	整除分块$(\sqrt{n})$ 解决



### 4.$\sum_{i=1}^{n}\sum_{j=1}^{m}lcm(i,j)$ 		[bzoj - 2154](https://www.lydsy.com/JudgeOnline/problem.php?id=2154)

​		$\sum_{i=1}^{n}\sum_{j=1}^{m}lcm(i,j)$

​	$=\sum_{i=1}^{n}\sum_{j=1}^{m}\frac{i\cdot j}{gcd(i,j)}$

​	$=\sum_{d=1}^{min(n,m)}\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)=d]\frac{i\cdot j}{d}$

​	$=\sum_{d=1}^{min(n,m)}\sum_{i=1}^{⌊\frac{n}{d}⌋}\sum_{j=1}^{⌊\frac{m}{d}⌋}[gcd(i,j)=1]i\cdot j$

​	$=\sum_{d=1}^{min(n,m)}d\cdot\sum_{i=1}^{⌊\frac{n}{d}⌋}i\cdot\sum_{j=1}^{⌊\frac{m}{d}⌋}j\cdot\sum_{x|gcd(i,j)}\mu(x)$

​	$=\sum_{d=1}^{min(n,m)}d\cdot\sum_{x=1}^{min(⌊\frac{n}{d}⌋,⌊\frac{m}{d}⌋)}\mu(x)\cdot\sum_{i=1}^{⌊\frac{n}{dx}⌋}i\cdot x\sum_{j=1}^{⌊\frac{m}{dx}⌋}j\cdot x$

​	$=\sum_{d=1}^{min(n,m)}d\cdot\sum_{x=1}^{min(⌊\frac{n}{d}⌋,⌊\frac{m}{d}⌋)}\mu(x)\cdot x^2\sum_{i=1}^{⌊\frac{n}{dx}⌋}i\cdot\sum_{j=1}^{⌊\frac{m}{dx}⌋}j$

​	$=\sum_{d=1}^{min(n,m)}d\cdot\sum_{x=1}^{min(⌊\frac{n}{d}⌋,⌊\frac{m}{d}⌋)}\mu(x)\cdot x^2\cdot\frac{⌊\frac{n}{dx}⌋\cdot(⌊\frac{n}{dx}⌋+1)}{2}\cdot\frac{⌊\frac{m}{dx}⌋\cdot(⌊\frac{m}{dx}⌋+1)}{2}$

​	令 $D=dx$

​	$=\sum_{D=1}^{min(n,m)}\cdot\frac{⌊\frac{n}{D}⌋\cdot(⌊\frac{n}{D}⌋+1)}{2}\cdot\frac{⌊\frac{m}{D}⌋\cdot(⌊\frac{m}{D}⌋+1)}{2}\cdot\sum_{x|D}\frac{D}{x}\cdot x^2\cdot\mu(x)$

​	$=\sum_{D=1}^{min(n,m)}\cdot\frac{⌊\frac{n}{D}⌋\cdot(⌊\frac{n}{D}⌋+1)}{2}\cdot\frac{⌊\frac{m}{D}⌋\cdot(⌊\frac{m}{D}⌋+1)}{2}\cdot\sum_{x|D}D\cdot x\cdot\mu(x)$

​	令 $f(D)=\sum_{x|D}D\cdot x\cdot\mu(x)$	积性函数，线性筛$f(D) $

​		$f(1)=1$

​		$f(p)=p-p^2$

​		$i\%x=0\quad f(i\cdot x)=f(i)\cdot x$

​		$i\%x≠0\quad f(i\cdot x)=f(i)\cdot f(x)=f(i)\cdot(x-x^2)$

​	整除分块$(\sqrt{n})$ 解决



### 5.$\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}\varphi(gcd(i,j^2,k^3))$		[hdu - 6428](http://acm.hdu.edu.cn/showproblem.php?pid=6428)

​		$\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}\varphi(gcd(i,j^2,k^3))$

​	$=\sum_{x=1}^{A}\varphi(k)\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}[gcd(i,j^2,k^3)=x]$

​	令 $f(x)=\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}[gcd(i,j^2,k^3)=x]\quad,\quad g(x)=\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}[x|gcd(i,j^2,k^3 )]$

​	$∴g(x)=\sum_{x|d}f(d)$ , 即 $g=f*I$

​	$∵\mu*I=e$

​	$∴f=g*\mu$

​	    $f(x)=\sum_{x|d}\mu(\frac{d}{x}))\cdot g(d)$

​				$=\sum_{x|d}\mu(\frac{d}{x})\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}[d|gcd(i,j^2,k^3)]$

​				$=\sum_{x|d}\mu(\frac{d}{x})\sum_{i=1}^{A}[d|i]\sum_{j=1}^{B}[d|j^2]\sum_{k=1}^{C}[d|k^3]$

​				$=\sum_{x=1}^{A}\varphi(x)\cdot f(x)$

​				$=\sum_{x=1}^{A}\varphi(x)\cdot\sum_{x|d}\mu(\frac{d}{x})\sum_{i=1}^{A}[d|i]\sum_{j=1}^{B}[d|j^2]\sum_{k=1}^{C}[d|k^3]$

​				$=\sum_{d=1}^{A}\quad\sum_{x|d}\mu(\frac{d}{x})\cdot\varphi(x)\quad\sum_{i=1}^{A}[d|i]\quad\sum_{j=1}^{B}[d|j^2]\quad\sum_{k=1}^{C}[d|k^3]$

​		预处理  $\sum_{x|d}\mu(\frac{d}{x})\cdot\varphi(x)$  ，  $\sum_{i=1}^{A}[d|i]$  ，  $\sum_{j=1}^{B}[d|j^2]$  和  $\sum_{k=1}^{C}[d|k^3]$   

​		令 $h(x)=\sum_{x|d}\mu(\frac{d}{x})\cdot\varphi(x)$	积性函数，线性筛$h(x)$

​			$h(1)=1$

​			$h(p)=p-2$

​			$h(p^k)=(p-1)^2\cdot p^{k-2}$

​			$i\%x≠0\quad h(i\cdot x)=h(i)\cdot h(x)$

​			$i\%x=0\quad h(i\cdot x)=h(\frac{i}{x^{a_1}})\cdot h(x^{a_1+1})=h(\frac{i}{x^{a_1}})\cdot (x-1)^2\cdot x^{a_1-1}\quad (i=p_1^{a_1}p_2^{a_2}\cdots p_k^{a_k})$

​			$a_1=F(i)$，即最小质因子的次数，之前筛过

​		令$f_k(x)=\prod_{i=1}^{n}p_i^{⌈\frac{a_i}{k}⌉}\quad(x=p_1^{a_1}p_2^{a_2}\cdots p_k^{a_k})$	积性函数

​		$∴\sum_{i=1}^A[d|i]=⌊\frac{A}{f_1(d)}⌋=⌊\frac{A}{d}⌋$

​			$\sum_{j=1}^B[d|j^2]=⌊\frac{B}{f_2(d)}⌋$

​			$\sum_{k=1}^C[d|k^3]=⌊\frac{C}{f_3(d)}⌋$

​		利用$F(i)$，线性筛$f_2(x)$和$f_3(x)$

​		$f_k(1)=1$	

​		$f_k(p)=p$

​		$i\%x=0\quad f_k(i\cdot x)=f_k(i)\cdot x^{⌈\frac{a_1+1}{k}⌉-⌈\frac{a_1}{k}⌉}$

​		$i\%x≠0\quad f_k(i\cdot x)=f_k(i)\cdot f_k(x)$



### 6.$\sum_{i=1}^n\sum_{j=1}^igcd(i^a-j^a,i^b-j^b)[gcd(i,j)=1]	$		[hdu - 6706](http://acm.hdu.edu.cn/showproblem.php?pid=6706)

​		$\sum_{i=1}^n\sum_{j=1}^igcd(i^a-j^a,i^b-j^b)[gcd(i,j)=1]$

​	$=\sum_{i=1}^n\sum_{j=1}^i(i-j)[gcd(i,j)=1]$

​	$=\sum_{i=1}^n\sum_{j=1}^ij\cdot[gcd(i,j)=1]$

​	利用欧拉函数性质

​		小于n且与n互质的数的和：	$S(n)=\begin{cases} \frac{n\cdot\varphi(n)}{2}，n≧2\\0，n=1\end{cases}$

​	$=\sum_{i=2}^nS(i)+S(1)$

​	$=\sum_{i=1}^n\frac{i\cdot\varphi(i)}{2}-\frac12$

​	$=\frac12\sum_{i=1}^n(i\cdot\varphi(i))-\frac12$

​	令$f(n)=\sum_{i=1}^ni\cdot\varphi(i)$

​		杜教筛模板，求得$f(n)=\frac{n(n+1)(2n+1)}6-\sum_{d=2}^nd\cdot f(⌊\frac nd⌋)$



### 7.$\sum_{i=1}^N\sum_{j=1}^Nlcm(a_i,a_j)$		[AtCoder - 5200](https://vjudge.net/problem/2770613/origin)

​		$\sum_{i=1}^N\sum_{j=1}^Nlcm(a_i,a_j)$

​	$=\sum_{i=1}^N\sum_{j=1}^N\frac{a_ia_j}{gcd(a_i,a_j)}$

​	$=\sum_{g=1}^{1e6}\sum_{i=1}^N\sum_{j=1}^N[gcd(a_i,a_j)=g]\cdot\frac{a_ia_j}g$

​	$=\sum_{g=1}^{1e6}\frac1g\cdot\sum_{i=1}^N\sum_{j=1}^Na_ia_j\cdot\sum_{d|gcd(\frac{a_i}g,\frac{a_j}g)}\mu(d)$

​	$=\sum_{g=1}^{1e6}\frac1g\cdot\sum_{i=1}^N\sum_{j=1}^Na_ia_j\cdot\sum_{d|\frac{a_i}g,d|\frac{a_j}g}\mu(d)$

​	$=\sum_{g=1}^{1e6}\frac1g\cdot\sum_{d=1}^{\frac{1e6}g}\mu(d)\cdot\sum_{gd|a_i}\sum_{gd|a_j}a_ia_j$

​	$=\sum_{gd=1}^{1e6}\sum_{d|gd}\mu(d)\cdot\frac{1}{id}(\frac{gd}d)\cdot(\sum_{gd|a_i}a_i)^2$

​	$=\sum_{n=1}^{1e6}\sum_{d|n}\mu(d)\cdot\frac{1}{id}(\frac{n}d)\cdot(\sum_{n|a_i}a_i)^2$

​	令$f=\mu*\frac1{id}，f(n)=\sum_{d|n}\mu(d)\cdot\frac1{id}(\frac nd)=\sum_{d|n}\mu(d)\cdot\frac dn $

​		$f(1)=1$

​		$f(p)=\frac1p-1$

​		$i\%x=0\quad f(i\cdot x)=\frac{f(i)}x$

​		$i\%x≠0\quad f(i\cdot x)=\frac{f(i)}x-f(i)$

​	令$g(n)=(\sum_{n|a_i}a_i)^2\quad$预处理$g(n)，O(nlog^n)$ 



### 8.$\sum_{i=1}^n\sum_{j=1}^m\mu(lcm(i,j))$		[hdu - 6715](http://acm.hdu.edu.cn/showproblem.php?pid=6715)

​		$\sum_{i=1}^n\sum_{j=1}^m\mu(lcm(i,j))$

​		其中$\mu(lcm(i,j))=\mu(i)\cdot\mu(j)\cdot\mu(gcd(i,j))$

​		证明：

​			①当 $\mu(i)$ 中 $\mu(j)$ 有一个等于0时，$\mu(lcm(i,j))$ 必然等于0，等式成立

​			②当 $\mu(i)\cdot\mu(j)≠0$ 时，说明 $\frac i{gcd(i,j)}，\frac{j}{gcd(i,j)}，gcd(i,j)$ 三者必然互相互质

​				$∴\mu(lcm(i,j))=\mu(\frac{ij}{gcd(i,j)})=\mu(\frac i{gcd(i,j)})\cdot\mu(\frac j{gcd(i,j)})\cdot\mu(gcd(i,j))$

​				当 $\mu(gcd(i,j))=0$ 时，左式和右式都等于0，等式成立			

​				当 $\mu(gcd(i,j))≠0$ 时，$\mu^2(gcd(i,j))=1$

​				$∴\mu(lcm(i,j))=\mu(\frac i{gcd(i,j)})\cdot\mu(\frac j{gcd(i,j)})\cdot\mu^3(gcd(i,j))=\mu(i)\cdot\mu(j)\cdot\mu(gcd(i,j))$，等式成立

​		$=\sum_{i=1}^n\sum_{j=1}^m=\mu(i)\cdot\mu(j)\cdot\mu(gcd(i,j))$

​		$=\sum_{d=1}^{min(n,m)}\sum_{i=1}^n\sum_{j=1}^m[gcd(i,j)=d]\mu(i)\cdot\mu(j)\cdot\mu(d)$

​		$=\sum_{d=1}^{min(n,m)}\mu(d)\cdot\sum_{i=1}^{⌊\frac nd⌋}\sum_{j=1}^{⌊\frac md⌋}[gcd(i,j)=1]\mu(id)\cdot\mu(jd)$

​		$=\sum_{d=1}^{min(n,m)}\mu(d)\cdot\sum_{k=1}^{min(⌊\frac nd⌋,⌊\frac md⌋)}\mu(k)\cdot\sum_{i=1}^{⌊\frac n{kd}⌋}\mu(ikd)\cdot\sum_{j=1}^{⌊\frac m{kd}⌋}\mu(jkd)$

​		令$x=kd$

​		$=\sum_{x=1}^{min(n,m)}\quad\sum_{d|x}\mu(d)\cdot\mu(\frac xd)\quad\sum_{i=1}^{⌊\frac n{x}⌋}\mu(ix)\quad\sum_{j=1}^{⌊\frac m{x}⌋}\mu(jx)$

​		预处理 $\sum_{d|x}\mu(d)\cdot\mu(\frac xd)，\sum_{i=1}^{⌊\frac n{x}⌋}\mu(ix)，\sum_{j=1}^{⌊\frac m{x}⌋}\mu(jx)\quad\quad 3\cdot O(nlog^n)$

